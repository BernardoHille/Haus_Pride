<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Experiência de Realidade Aumentada Pride</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const video = document.getElementById("video");
      const overlay = document.getElementById("overlay");
      const scanOverlay = document.getElementById("scan_svg");

      // Garante que o vídeo começa no mudo e tenta autoplay
      video.muted = true;
      video.playsInline = true; // Garantia extra para iOS
      video.autoplay = true;

      // Tenta iniciar o vídeo automaticamente
      video.play().catch((err) => {
        console.log("Autoplay bloqueado. Requer interação do usuário.", err);
        overlay.style.display = "block";
      });

      // Remove o overlay após interação do usuário e inicia o vídeo
      overlay.addEventListener("click", function () {
        video.muted = false; // Habilita som se necessário
        video.play();
        overlay.style.display = "none";
      });

      const sceneEl = document.querySelector("a-scene");
      let arSystem;

      sceneEl.addEventListener("loaded", function () {
        arSystem = sceneEl.systems["mindar-image-system"];
      });

      const exampleTarget = document.querySelector("#example-target");
      let lostTimeout;

      // Evento quando o target é encontrado
      exampleTarget.addEventListener("targetFound", function () {
        console.log("Target encontrado");
        video.play();
        video.muted = false;
        scanOverlay.style.display = "none";
        clearTimeout(lostTimeout);
      });

      // Evento quando o target é perdido
      exampleTarget.addEventListener("targetLost", function () {
        console.log("Target perdido");
        video.pause();
        video.muted = true;
        scanOverlay.style.display = "block";
        lostTimeout = setTimeout(() => {
          video.currentTime = 0; // Reinicia o vídeo
        }, 10000);
      });
    });
  </script>
  <style>
    #overlay {
      position: fixed;
      display: none; /* Começa oculto */
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      top: 0;
      left: 0;
      z-index: 10;
    }
    #overlay img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 300px;
    }
    #scan_svg {
      position: fixed;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
    }

	#acessar_site{
	  position: fixed;       /* Deixa a imagem fixa na tela */
	  width: 80%;            /* Tamanho da imagem */
	  bottom: 30%;           /* Alinha a imagem na parte inferior */
	  left: 50%;             /* Centraliza horizontalmente */
	  transform: translateX(-50%); /* Ajusta para centralizar totalmente */
	  z-index: 1000;
	  max-width: 300px;
	}
	#feito_por_aeon{
	  position: fixed;       /* Deixa a imagem fixa na tela */
	  width: 100%;            /* Tamanho da imagem */
	  bottom: 1%;           /* Alinha a imagem na parte inferior */
	  right:5%;            /* Centraliza horizontalmente */
	  /* transform: translateX(-50%); Ajusta para centralizar totalmente */
	  z-index: 1000;
	  max-width: 180px;
	}
	#logo{
	  position: fixed;       /* Deixa a imagem fixa na tela */
	  width: 50%;            /* Tamanho da imagem */
	  bottom: 15%;             /* Alinha a imagem na parte inferior */
	  left: 50%;             /* Centraliza horizontalmente */
	  transform: translateX(-50%); /* Ajusta para centralizar totalmente */
	  max-width: 300px;
	}
  </style>
</head>
<body>
  <div id="overlay">
    <img src="logo_pride_branca.svg" alt="Clique para começar">
  </div>
  <div id="scanning-overlay" class="hidden">
    <img src="pride_scan_frame.svg" id="scan_svg">
  </div>
  <a-scene mindar-image="imageTargetSrc: pride_targets.mind; filterMinCF:0.001; filterBeta: 0.001; warmupTolerance: 10; missTolerance: 10; uiScanning: #scanning-overlay;" device-orientation-permission-ui="enabled: false" xr-mode-ui="enabled: false">
    <a-assets>
      <video id="video" src="Pride_editado.mp4" autoplay muted playsinline loop crossorigin="anonymous"></video>
    </a-assets>
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    <a-entity mindar-image-target="targetIndex: 0" id="example-target">
      <a-video src="#video" width="1.08" height="0.68" position="0 0 0" rotation="0 0 0"></a-video>
    </a-entity>
  </a-scene>
  <img src="logo_pride_branca.svg" id="logo">
  <a href="https://construtorapride.com.br/empreendimentos/palazzo"><img src="T_acessarSite.svg" id="acessar_site"></a>
  <a href="https://www.aeonvr.com.br/"><img src="feito_por_aeon.svg" id="feito_por_aeon"></a>
</body>
</html>
